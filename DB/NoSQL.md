# NoSQL

> 관계형 데이터 모델이 아니라 대량의 분산된 데이터를 저장하고 조회하는데 특화, 스키마 없이 사용 가능하거나 느슨한 스키마를 제공하는 저장소를 말한다.

종류마다 쓰기/읽기 성능 특화, 2차 인덱스 지원, 오토 샤딩 지원 같은 고유한 특징 가짐



### CAP 이론

#### 1. 일관성(Consistency)

다중 클라이언트에서 같은 시간에 조회하는 데이터는 항상 동일한 데이터이다.

각 NoSQL들은 분산 노드간의 데이터 동기화를 위해 2가지 방법 사용

- 데이터 저장 결과를 클라이언트 응답하기 전에 모든 노드에 데이터를 저장하는 동기식 방법 : 느리지만 정확
- 메모리나 임시 파일에 기록하고 클라이언트에 응답한 다음, 특정 이벤트 또는 프로세스를 사용하여 노드로 데이터를 동기화하는 비동기식 방법 : 빠른 응답시간, 쓰기 노드에 장애 발생시 데이터 손실



#### 2. 가용성(Availability)

모든 클라이언트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야함

몇 NoSQL은 가용성 보장 위해 데이터 복제 사용. 동일한 데이터를 다중 노드에 중복 저장해 몇 개의 노드가 고장나도 데이터가 유실되지 않도록 하는 것



#### 4. 네트워크 분할 허용성(Partition tolerance)

분할된 네트워크에서 두 지역간 연결이 끊겨도 각 지역 내의 시스템이 정상적으로 동작해야 한다.



### 저장 방식에 따른 NoSQL 분류

> `Key-Value` , `Document`, `Column` , `Graph` 모델로 분류할 수 있다.

#### 1.Key-Value Model

- 키 하나로 데이터 저장 조회하는 단일 키-값 구조

- 고속 읽기,쓰기에 최적화

- 사용자 프로필 정보, 웹 서버 클러스터를 위한 세션 정보, 장바구니 정보 저장 등에 사용

- 하나의 서비스 요청에 다수의 데이터 조회,수정 연산이 발생하면 트렌젝션 처리 불가 -> 데이터 정합성 보장X



#### 2.Document Model

- 하나의 키에 하나의 구조화된 문서를 저장하고 조회.

- 문서 ID에 대한 인덱스를 사용해 O(1) 시간만에 문서 조회 가능

- 대부분 B 트리 인덱스를 사용해 2차 인덱스 생성. B 트리는 크기가 커질수록 입력,삭제 성능 떨어짐 -> 읽기,쓰기 비율이 7:3 정도일 때 가장 좋은 성능

- 중앙 집중식 로그, 타임라인, 통계 정보 저장 등에 사용



#### 3. Column Model

- 하나의 키에 여러 개의 컬럼 이름과 컬럼 값의 쌍으로 이루어진 데이터를 저장,조회. 모든 컬럼은 항상 타임 스탬프 값과 함께 저장된다.
- 구글의 빅테이블이 대표적, Row Key, Column Key, Column Family 같은 빅테이블 개념이 공통적으로 사용.
- 저장의 기본단위는 컬럼, 컬럼은 컬럼 이름, 값 타임스탬프로 구성. 이러한 컬럼들의 집합이 로우(Row), 로우 키는 각 로우를 유일하게 식별하는 값. 로우들의 집합은 키 스페이스
- 대부분은 쓰기에 더 특화. 데이터를 먼저 커밋로그와 메모리에 저장 후 응답하기 때문에 빠른 응답속도
- 채팅 내용 저장, 실시간 분석을 위한 데이터 저장소